<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="refresh" content="30">
  <style>
    body { 
      background: #000; 
      color: #0f0; 
      font-family: monospace; 
      text-align: center; 
      padding: 20px; 
    }
    h1 { 
      font-size: 2em; 
      margin-bottom: 10px; 
    }
    .bus-time { 
      font-size: 3em; 
      font-weight: bold; 
      margin: 20px; 
    }
    .updated { 
      color: #555; 
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>BUS 55 ¬∑ CHERRY HILL RD</h1>
  <div id="arrival" class="bus-time">--</div>
  <div id="updated" class="updated"></div>

<script>
  async function updateBus() {
    try {
      const response = await fetch('/.netlify/functions/fetch-wmata');
      const data = await response.json();

      console.log("üü¢ API Data:", data);

      if (!data.arrivals || data.arrivals.length === 0) {
        document.getElementById('arrival').innerHTML = "<div class='bus-time'>NO BUSES</div>";
        return;
      }

      const arrivalHTML = data.arrivals.map(bus => `
        <div class="bus-time">
          <strong>Route ${bus.RouteID}</strong> ‚Üí ${bus.DirectionText}<br>
          ${
            bus.Type === "live"
              ? (bus.Min === 0 ? "ARRIVING NOW" : `${bus.Min} MIN`)
              : `Scheduled: ${bus.Time}`
          }
          <div style="font-size: 0.5em; color: #666;">(${bus.Type})</div>
        </div>
      `).join("");

      document.getElementById('arrival').innerHTML = arrivalHTML;
      document.getElementById('updated').textContent = "Updated: " + new Date().toLocaleTimeString();
    } catch (err) {
      console.error("‚ùå Fetch error:", err);
      document.getElementById('arrival').textContent = "ERROR";
    }
  }

  updateBus();
  setInterval(updateBus, 30000); // refresh every 30s
</script>


</body>
</html>
