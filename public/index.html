<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="refresh" content="30">
  <style>
    body { 
      background: #000; 
      color: #0f0; 
      font-family: monospace; 
      text-align: center; 
      padding: 20px; 
    }
    h1 { 
      font-size: 2em; 
      margin-bottom: 10px; 
    }
    .bus-time { 
      font-size: 3em; 
      font-weight: bold; 
      margin: 20px; 
    }
    .updated { 
      color: #555; 
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>BUS 55 Â· CHERRY HILL RD</h1>
  <div id="arrival" class="bus-time">--</div>
  <div id="updated" class="updated"></div>

<script>
async function updateBus() {
  try {
    const response = await fetch('/.netlify/functions/fetch-wmata');
    const data = await response.json();
    
    const arrivalDiv = document.getElementById('arrival');
    const updatedDiv = document.getElementById('updated');
    
    if (data.error) {
      arrivalDiv.textContent = "SERVICE UNAVAILABLE";
      return;
    }

    if (data.predictions.length === 0) {
      arrivalDiv.textContent = "NO BUSES";
    } else {
      const nextBus = data.predictions[0];
      arrivalDiv.textContent = nextBus.Minutes === 0 
        ? "ARRIVING NOW" 
        : `${nextBus.Minutes} MIN`;
    }
    
    updatedDiv.textContent = `Updated: ${new Date().toLocaleTimeString()}`;
    
  } catch (error) {
    document.getElementById('arrival').textContent = "NETWORK ERROR";
  }
}

// Initial load + refresh every 30 sec
updateBus();
setInterval(updateBus, 30000);
</script>

</body>
</html>
